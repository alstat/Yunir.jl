<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Text Alignment · Yunir.jl</title><meta name="title" content="Text Alignment · Yunir.jl"/><meta property="og:title" content="Text Alignment · Yunir.jl"/><meta property="twitter:title" content="Text Alignment · Yunir.jl"/><meta name="description" content="Documentation for Yunir.jl."/><meta property="og:description" content="Documentation for Yunir.jl."/><meta property="twitter:description" content="Documentation for Yunir.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.png" alt="Yunir.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.png" alt="Yunir.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Yunir.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../basic_utilities/">Basic Utilities</a></li><li><a class="tocitem" href="../orthography/">Orthographical Analysis</a></li><li><a class="tocitem" href="../rhythmic_analysis/">Rhytmic Analysis</a></li><li><a class="tocitem" href="../symmetry_analysis/">Symmetry Analysis</a></li><li><a class="tocitem" href="../references/">References</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Text Alignment</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Text Alignment</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/alstat/Yunir.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Text-Alignment"><a class="docs-heading-anchor" href="#Text-Alignment">Text Alignment</a><a id="Text-Alignment-1"></a><a class="docs-heading-anchor-permalink" href="#Text-Alignment" title="Permalink"></a></h1><p>Text alignment is used for pairwise comparison of texts (e.g. books), with the aim of checking for deletions, insertions, matches and mismatches in the target texts relative to a reference texts. This is the same task as sequence alignment of two DNA sequence as in Biology. Indeed, Yunir.jl supports this by extending the <a href="https://github.com/BioJulia/BioAlignments.jl">BioAlignments.jl</a> APIs  to sequence of Arabic texts. Yunir.jl uses <code>align</code> function for aligning two texts.</p><h2 id="How-it-works"><a class="docs-heading-anchor" href="#How-it-works">How it works</a><a id="How-it-works-1"></a><a class="docs-heading-anchor-permalink" href="#How-it-works" title="Permalink"></a></h2><p>The way it works is that, <a href="https://github.com/BioJulia/BioAlignments.jl">BioAlignments.jl</a> requires a Roman characters as input for pairwise alignment. Therefore, any Arabic characters must first be transliterated to Roman characters. This is possible using Yunir.jl&#39;s <code>encode</code> function. The resulting alignment, which is in Roman characters, is then transliterated back to Arabic for easy interpretation.</p><h2 id="KITAB-project&#39;s-text-reuse"><a class="docs-heading-anchor" href="#KITAB-project&#39;s-text-reuse">KITAB project&#39;s text reuse</a><a id="KITAB-project&#39;s-text-reuse-1"></a><a class="docs-heading-anchor-permalink" href="#KITAB-project&#39;s-text-reuse" title="Permalink"></a></h2><p>We will consider a simple example based on &quot;text reuse&quot; case study of <a href="https://kitab-project.org/methods/text-reuse">KITAB project</a>. The following are portions of two books with IDs Shamela0012129-ara1 and Shamela0023790-ara1 which was detected by &quot;passim&quot; (the tool used by KITAB project) as similar. The goal is to compare the two input texts by aligning the characters, and see the similarity based on matches, mismatches, deletions and insertions of characters. In the example texts below, we&#39;ll confirm the matches and see how Yunir.jl&#39;s APIs work on text alignment.</p><table>
    <thead>
        <th>Shamela0012129-ara1</th>
        <th>Shamela0023790-ara1</th>
    </thead>
    <tbody>
        <tr>
            <td>خرج مع ابي بكر الصديق رضي الله عنه في تجارة الي بصري ومعهم نعيمان وكان نعيمان ممن شهد——- بدرا ايضا وك——-ان علي الزاد فقال له سويبط———– اطعمني فقال حتي يجء ابو بكر فقال اما والله لاغيظنك فمروا بقوم فقال لهم سويبط -تشترون مني عبدا قا—لوا نعم فقال انه عبد له كلام وهو قاءل لكم اني حر فان كنتم اذا قال لكم هذه المقالة تركتموه فلا تفسدوا علي عبدي قا-لوا بل نشتريه منك فاشتروه بعشر قلاءص ثم جاءوا فوضعوا في عنقه حبلا ف—————قال نعيمان ان هذا يستهزء بكم واني حر فقالوا قد عرفنا –خبرك وانطلقوا به فلما جاء ابو بكر -اخبروه فاتبعهم ورد عليهم القلاءص واخذه فلما قدموا علي النبي صلي الله عليه وسلم اخبروه فضحك هو واصحابه من ذلك حولا</td>
            <td>خرج— ابو بكر——————– في تجارة——— ومعه- نعيمان وسويبط بن حرملة وكانا شهدا بدر—–ا وكان نعيمان علي الزاد فقال له سويبط وكان مزاحا اطعمني فقال حتي يجء ابو بكر فقال اما والله لاغيظنك فمروا بقوم فقال لهم سويبط اتشترون مني عبدا لي قالوا نعم ق-ال انه عبد له كلام وهو قاءل لكم اني حر فان كنتم اذا قال لكم هذه المقالة تركتموه فلا تفسدوا علي عبدي فقالوا بل نشتريه منك——– بعشر قلاءص ثم جاءوا فوضعوا في عنقه حبلا وعمامة واشتروه فقال نعيمان ان هذا يستهزء بكم واني حر قا-لوا قد اخبرنا بخبرك وانطلقوا به و—-جاء ابو بكر فاخبروه فاتبعهم فرد عليهم القلاءص واخذه فلما قدموا علي النبي صلي الله عليه وسلم اخبروه فضحك هو واصحابه منهما- حول</td>
        </tr>
    </tbody>
</table><h3 id="Data-processing"><a class="docs-heading-anchor" href="#Data-processing">Data processing</a><a id="Data-processing-1"></a><a class="docs-heading-anchor-permalink" href="#Data-processing" title="Permalink"></a></h3><p>To have a quality output, we will need to process the texts to remove unnecessary noise. First, we need to remove all non-Arabic characters. To start with, the following will input the two candidate texts:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Yunir</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0012129 = &quot;خرج مع ابي بكر الصديق رضي الله عنه في تجارة الي بصري ومعهم نعيمان وكان نعيمان ممن شهد——- بدرا ايضا وك——-ان علي الزاد فقال له سويبط———– اطعمني فقال حتي يجء ابو بكر فقال اما والله لاغيظنك فمروا بقوم فقال لهم سويبط -تشترون مني عبدا قا—لوا نعم فقال انه عبد له كلام وهو قاءل لكم اني حر فان كنتم اذا قال لكم هذه المقالة تركتموه فلا تفسدوا علي عبدي قا-لوا بل نشتريه منك فاشتروه بعشر قلاءص ثم جاءوا فوضعوا في عنقه حبلا ف—————قال نعيمان ان هذا يستهزء بكم واني حر فقالوا قد عرفنا –خبرك وانطلقوا به فلما جاء ابو بكر -اخبروه فاتبعهم ورد عليهم القلاءص واخذه فلما قدموا علي النبي صلي الله عليه وسلم اخبروه فضحك هو واصحابه من ذلك حولا&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0023790 = &quot;خرج— ابو بكر——————– في تجارة——— ومعه- نعيمان وسويبط بن حرملة وكانا شهدا بدر—–ا وكان نعيمان علي الزاد فقال له سويبط وكان مزاحا اطعمني فقال حتي يجء ابو بكر فقال اما والله لاغيظنك فمروا بقوم فقال لهم سويبط اتشترون مني عبدا لي قالوا نعم ق-ال انه عبد له كلام وهو قاءل لكم اني حر فان كنتم اذا قال لكم هذه المقالة تركتموه فلا تفسدوا علي عبدي فقالوا بل نشتريه منك——– بعشر قلاءص ثم جاءوا فوضعوا في عنقه حبلا وعمامة واشتروه فقال نعيمان ان هذا يستهزء بكم واني حر قا-لوا قد اخبرنا بخبرك وانطلقوا به و—-جاء ابو بكر فاخبروه فاتبعهم فرد عليهم القلاءص واخذه فلما قدموا علي النبي صلي الله عليه وسلم اخبروه فضحك هو واصحابه منهما- حول&quot;;</code></pre><p>Next, we remove the non-Arabic characters like the dashes using the <code>clean</code> function:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0012129_cln = clean(shamela0012129)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;خرج مع ابي بكر الصديق رضي الله عنه في تجارة الي بصري ومعهم نعيمان وكان نعيمان ممن شهد بدرا ايضا وكان علي الزاد فقال له سويبط اطعمني فقال حتي يجء ابو بكر فقال اما والله لاغيظنك فمروا بقوم فقال لهم سويبط تشترون مني عبدا قالوا نعم فقال انه عبد له كلام وهو قاءل لكم اني حر فا&quot;<span class="sgr93"><span class="sgr1"> ⋯ 105 bytes ⋯ </span></span>&quot; قالوا بل نشتريه منك فاشتروه بعشر قلاءص ثم جاءوا فوضعوا في عنقه حبلا فقال نعيمان ان هذا يستهزء بكم واني حر فقالوا قد عرفنا خبرك وانطلقوا به فلما جاء ابو بكر اخبروه فاتبعهم ورد عليهم القلاءص واخذه فلما قدموا علي النبي صلي الله عليه وسلم اخبروه فضحك هو واصحابه من ذلك حولا&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0023790_cln = clean(shamela0023790)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;خرج ابو بكر في تجارة ومعه نعيمان وسويبط بن حرملة وكانا شهدا بدرا وكان نعيمان علي الزاد فقال له سويبط وكان مزاحا اطعمني فقال حتي يجء ابو بكر فقال اما والله لاغيظنك فمروا بقوم فقال لهم سويبط اتشترون مني عبدا لي قالوا نعم قال انه عبد له كلام وهو قاءل لكم اني حر فان كنتم اذا&quot;<span class="sgr93"><span class="sgr1"> ⋯ 94 bytes ⋯ </span></span>&quot;لوا بل نشتريه منك بعشر قلاءص ثم جاءوا فوضعوا في عنقه حبلا وعمامة واشتروه فقال نعيمان ان هذا يستهزء بكم واني حر قالوا قد اخبرنا بخبرك وانطلقوا به وجاء ابو بكر فاخبروه فاتبعهم فرد عليهم القلاءص واخذه فلما قدموا علي النبي صلي الله عليه وسلم اخبروه فضحك هو واصحابه منهما حول&quot;</code></pre><div class="admonition is-category-tips" id="Tips-4ea82d5a81d28eed"><header class="admonition-header">Tips<a class="admonition-anchor" href="#Tips-4ea82d5a81d28eed" title="Permalink"></a></header><div class="admonition-body"><p>The <code>clean</code> function removes the non-Arabic characters through RegEx or <a href="https://en.wikipedia.org/wiki/Regular_expression">Regular Expression</a>, which is set at the third argument of the function. That is, <code>clean(shamela0012129)</code> is actually equivalent to:</p><pre><code class="language-julia hljs">clean(shamela0012129; replace_non_ar=&quot;&quot;, target_regex=r&quot;[A-Za-z0-9\(:×\|\–\[\«\»\]~\)_@./#&amp;+\—-]*&quot;)</code></pre><p>In case there are still non-Arabic characters not captured using the default regex, simply insert it to the default pattern.</p></div></div><div class="admonition is-warning" id="Caution-317a66ce61045ea7"><header class="admonition-header">Caution<a class="admonition-anchor" href="#Caution-317a66ce61045ea7" title="Permalink"></a></header><div class="admonition-body"><p>It is important that all non-Arabic characters be removed since any special character might be transliterated to a particular Arabic character once transliterating the output back to Arabic, and the result might mislead. See the section &quot;How it works&quot; above.</p></div></div><p>Next, we need to normalize the word Allah, الله, into a single Unicode <a href="https://www.compart.com/en/unicode/U+FDF2">U+FDF2</a>. This is because this word or name consist of 4 consonants, but most software assigns this into a single Unicode when detected, and hence it is better to convert it in the first place. This is also true with Lam-Alif, ﻻ, composed of two letters but we can assign it to a single Unicode <a href="https://www.compart.com/en/unicode/U+FEFB">U+FEFB</a>. To do this, we define a mapping of these characters for the normalizer and then use it to normalize the input texts.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; mapping = Dict(
           &quot;الله&quot; =&gt; &quot;ﷲ&quot;,
           &quot;لا&quot; =&gt; &quot;ﻻ&quot;
       );</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0012129_nrm = normalize(shamela0012129_cln, mapping)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;خرج مع ابي بكر الصديق رضي ﷲ عنه في تجارة الي بصري ومعهم نعيمان وكان نعيمان ممن شهد بدرا ايضا وكان علي الزاد فقال له سويبط اطعمني فقال حتي يجء ابو بكر فقال اما وﷲ ﻻغيظنك فمروا بقوم فقال لهم سويبط تشترون مني عبدا قالوا نعم فقال انه عبد له كﻻم وهو قاءل لكم اني حر فان كنتم ا&quot;<span class="sgr93"><span class="sgr1"> ⋯ 77 bytes ⋯ </span></span>&quot;لي عبدي قالوا بل نشتريه منك فاشتروه بعشر قﻻءص ثم جاءوا فوضعوا في عنقه حبﻻ فقال نعيمان ان هذا يستهزء بكم واني حر فقالوا قد عرفنا خبرك وانطلقوا به فلما جاء ابو بكر اخبروه فاتبعهم ورد عليهم القﻻءص واخذه فلما قدموا علي النبي صلي ﷲ عليه وسلم اخبروه فضحك هو واصحابه من ذلك حوﻻ&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0023790_nrm = normalize(shamela0023790_cln, mapping)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;خرج ابو بكر في تجارة ومعه نعيمان وسويبط بن حرملة وكانا شهدا بدرا وكان نعيمان علي الزاد فقال له سويبط وكان مزاحا اطعمني فقال حتي يجء ابو بكر فقال اما وﷲ ﻻغيظنك فمروا بقوم فقال لهم سويبط اتشترون مني عبدا لي قالوا نعم قال انه عبد له كﻻم وهو قاءل لكم اني حر فان كنتم اذا قال &quot;<span class="sgr93"><span class="sgr1"> ⋯ 74 bytes ⋯ </span></span>&quot;دي فقالوا بل نشتريه منك بعشر قﻻءص ثم جاءوا فوضعوا في عنقه حبﻻ وعمامة واشتروه فقال نعيمان ان هذا يستهزء بكم واني حر قالوا قد اخبرنا بخبرك وانطلقوا به وجاء ابو بكر فاخبروه فاتبعهم فرد عليهم القﻻءص واخذه فلما قدموا علي النبي صلي ﷲ عليه وسلم اخبروه فضحك هو واصحابه منهما حول&quot;</code></pre><h3 id="Encoding"><a class="docs-heading-anchor" href="#Encoding">Encoding</a><a id="Encoding-1"></a><a class="docs-heading-anchor-permalink" href="#Encoding" title="Permalink"></a></h3><p>As emphasized above, Yunir.jl is based on <a href="https://github.com/BioJulia/BioAlignments.jl">BioAlignments.jl</a> APIs to do the pairwise alignment, and <a href="https://github.com/BioJulia/BioAlignments.jl">BioAlignments.jl</a> requires  a Roman input character. Therefore, the input Arabic texts need to be encoded or transliterated to Roman characters.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0012129_enc = encode(shamela0012129_nrm)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;xrj mE Aby bkr AlSdyq rDy G Enh fy tjArp Aly bSry wmEhm nEymAn wkAn nEymAn mmn \$hd bdrA AyDA wkAn Ely AlzAd fqAl lh swybT ATEmny fqAl Hty yj&#39; Abw bkr fqAl AmA wG LgyZnk fmrwA bqwm fqAl lhm swybT t\$trwn mny EbdA qAlwA nEm fqAl Anh Ebd lh kLm whw qA&#39;l lkm Any Hr fAn kntm A&quot;<span class="sgr93"><span class="sgr1"> ⋯ 41 bytes ⋯ </span></span>&quot;Ely Ebdy qAlwA bl n\$tryh mnk fA\$trwh bE\$r qL&#39;S vm jA&#39;wA fwDEwA fy Enqh HbL fqAl nEymAn An h*A ysthz&#39; bkm wAny Hr fqAlwA qd ErfnA xbrk wAnTlqwA bh flmA jA&#39; Abw bkr Axbrwh fAtbEhm wrd Elyhm AlqL&#39;S wAx*h flmA qdmwA Ely Alnby Sly G Elyh wslm Axbrwh fDHk hw wASHAbh mn *lk HwL&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0023790_enc = encode(shamela0023790_nrm)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;xrj Abw bkr fy tjArp wmEh nEymAn wswybT bn Hrmlp wkAnA \$hdA bdrA wkAn nEymAn Ely AlzAd fqAl lh swybT wkAn mzAHA ATEmny fqAl Hty yj&#39; Abw bkr fqAl AmA wG LgyZnk fmrwA bqwm fqAl lhm swybT At\$trwn mny EbdA ly qAlwA nEm qAl Anh Ebd lh kLm whw qA&#39;l lkm Any Hr fAn kntm A*A qAl &quot;<span class="sgr93"><span class="sgr1"> ⋯ 39 bytes ⋯ </span></span>&quot;bdy fqAlwA bl n\$tryh mnk bE\$r qL&#39;S vm jA&#39;wA fwDEwA fy Enqh HbL wEmAmp wA\$trwh fqAl nEymAn An h*A ysthz&#39; bkm wAny Hr qAlwA qd AxbrnA bxbrk wAnTlqwA bh wjA&#39; Abw bkr fAxbrwh fAtbEhm frd Elyhm AlqL&#39;S wAx*h flmA qdmwA Ely Alnby Sly G Elyh wslm Axbrwh fDHk hw wASHAbh mnhmA Hwl&quot;</code></pre><h3 id="Alignment"><a class="docs-heading-anchor" href="#Alignment">Alignment</a><a id="Alignment-1"></a><a class="docs-heading-anchor-permalink" href="#Alignment" title="Permalink"></a></h3><p>Finally, we can do the alignment as follows:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res1 = align(shamela0012129_enc, shamela0023790_enc);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; res1</code><code class="nohighlight hljs ansi" style="display:block;">PairwiseAlignment
١-reference
٢-target

٢    خرجـــ ابو بكـــــــــرــــــــ في تجارةـــــــــ ومعهـ نعي
     ااا   ااا ااا         ا        ااااااااا         ااااا اااا
١    خرج مع ابي بكر الصديق رضي ﷲ عنه في تجارة الي بصري ومعهم نعي

٢    ان وسويبط بن حرملة وكانا شهدا بدرا وكان نعيمان علي الزاد فق
     ااا  ا   ا ا   ا  ا   ا اااا اااااا  ا      ااااااااااااااا
١    ان ــوكان ـنـعيمان ـممنـ شهدـ بدرا ــايضا وكان علي الزاد فق

٢    ل له سويبط وكان مزاحا اطعمني فقال حتي يجء ابو بكر فقال اما
     اااااااااا           اااااااااااااااااااااااااااااااااااااا
١    ل له سويبطـــــــــــ اطعمني فقال حتي يجء ابو بكر فقال اما

٢    ﷲ ﻻغيظنك فمروا بقوم فقال لهم سويبط اتشترون مني عبدا لي قالو
     ااااااااااااااااااااااااااااااااااا ااااااااااااااا   ااااا
١    ﷲ ﻻغيظنك فمروا بقوم فقال لهم سويبط ـتشترون مني عبداـــ قالو

٢     نعم ـقال انه عبد له كﻻم وهو قاءل لكم اني حر فان كنتم اذا ق
     ااااا ااااااااااااااااااااااااااااااااااااااااااااااااااااا
١     نعم فقال انه عبد له كﻻم وهو قاءل لكم اني حر فان كنتم اذا ق

٢    ل لكم هذه المقالة تركتموه فﻻ تفسدوا علي عبدي فقالوا بل نشتر
     ااااااااااااااااااااااااااااااااااااااااااااا ااااااااااااا
١    ل لكم هذه المقالة تركتموه فﻻ تفسدوا علي عبدي ـقالوا بل نشتر

٢    ه منكــــــــ بعشر قﻻءص ثم جاءوا فوضعوا في عنقه حبﻻ وعمامة
     ااااا        اااااااااااااااااااااااااااااااااااااا
١    ه منك فاشتروه بعشر قﻻءص ثم جاءوا فوضعوا في عنقه حبﻻــــــــ

٢    اشتروه فقال نعيمان ان هذا يستهزء بكم واني حر ـقالوا قد اخبر
           ااااااااااااااااااااااااااااااااااااااا ااااااااا
١    ــــــ فقال نعيمان ان هذا يستهزء بكم واني حر فقالوا قد ـعرف

٢    ا بخبرك وانطلقوا به ــــوجاء ابو بكر فاخبروه فاتبعهم فرد عل
     اا ااااااااااااااااا     اااااااااااا ااااااااااااااا ااااا
١    ا ـخبرك وانطلقوا به فلما جاء ابو بكر ـاخبروه فاتبعهم ورد عل

٢    هم القﻻءص واخذه فلما قدموا علي النبي صلي ﷲ عليه وسلم اخبروه
     ااااااااااااااااااااااااااااااااااااااااااااااااااااااااااا
١    هم القﻻءص واخذه فلما قدموا علي النبي صلي ﷲ عليه وسلم اخبروه</code></pre><p>Unfortunately, many software and text editors including the Julia REPL have default left-to-right printing, and hence the alignment above is not clear. What you can do is to copy the output above and paste it into a text editor with Arabic Monospace font (e.g. <a href="https://makkuk.com/kawkab-mono/#:~:text=Kawkab%20Mono%20(%D9%83%D9%88%D9%83%D8%A8%20%D9%85%D9%88%D9%86%D9%88)%20is,a%20void%20in%20this%20niche.">Kawkab font</a>), and set it to right-justified or set the text direction to right-to-left (RTL). Here is the result under the <a href="https://notepad-plus-plus.org/">Notepad++</a> (after setting the text direction to RTL):</p><p><img src="../../assets/alignment2.png" alt="Alignment-Output-in-Text-Editor"/></p><p>The result of the alignment is a list of groups of reference text indicated by the Arabic  character ١, and the target texts indicated by the Arabic character ٢. </p><div class="admonition is-info" id="Definitions-b288e8f9c66cc631"><header class="admonition-header">Definitions<a class="admonition-anchor" href="#Definitions-b288e8f9c66cc631" title="Permalink"></a></header><div class="admonition-body"><ul><li><em>Match</em>, if the characters of reference and target did match, a Alif (i.e., ا) between their rows is placed. </li><li><em>Deletion</em>, if a tatweel (i.e., &quot;ـ&quot;) is present in the target text, it means those tatweels represent the deletion of characters from the reference text. </li><li><em>Insertion</em>, if a tatweel is present in the reference text, it means an insertion of characters was done in the target text. </li><li><em>Mismatch</em>, if both characters of target and reference texts did not match, a space is inserted between their rows.</li></ul></div></div><div class="admonition is-info" id="Note-14dd248d0cee9ae5"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-14dd248d0cee9ae5" title="Permalink"></a></header><div class="admonition-body"><p>If we did not normalize the word &quot;الله&quot; into a single character, there would be four Alif if all letters did match, but because most software prints this as a single character, then there will be four Alif for a single character, and this will make the output confusing to readers. This is true for لا as well.</p></div></div><h3 id="Alignment-in-Buckwalter"><a class="docs-heading-anchor" href="#Alignment-in-Buckwalter">Alignment in Buckwalter</a><a id="Alignment-in-Buckwalter-1"></a><a class="docs-heading-anchor-permalink" href="#Alignment-in-Buckwalter" title="Permalink"></a></h3><p>We can actually extract the encoded version, which is in extended Buckwalter transliteration mapping. This can be accessed via the <code>.alignment</code> property of the <code>res</code> above. That is,</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res1.alignment</code><code class="nohighlight hljs ansi" style="display:block;">BioAlignments.PairwiseAlignment{String, String}:
  seq:   1 xrj--- Abw bk---------r-------- fy tjArp--------- wmEh- nEym  30
           |||   ||| |||         |        |||||||||         ||||| |||||
  ref:   1 xrj mE Aby bkr AlSdyq rDy G Enh fy tjArp Aly bSry wmEhm nEym  60

  seq:  31 An wswybT bn Hrmlp wkAnA $hdA bdrA wkAn nEymAn Ely AlzAd fqA  90
           |||  |   | |   |  |   | |||| ||||||  |      ||||||||||||||||
  ref:  61 An --wkAn -n-EymAn -mmn- $hd- bdrA --AyDA wkAn Ely AlzAd fqA 111

  seq:  91 l lh swybT wkAn mzAHA ATEmny fqAl Hty yj&#39; Abw bkr fqAl AmA w 150
           ||||||||||           |||||||||||||||||||||||||||||||||||||||
  ref: 112 l lh swybT----------- ATEmny fqAl Hty yj&#39; Abw bkr fqAl AmA w 160

  seq: 151 G LgyZnk fmrwA bqwm fqAl lhm swybT At$trwn mny EbdA ly qAlwA 210
           ||||||||||||||||||||||||||||||||||| |||||||||||||||   ||||||
  ref: 161 G LgyZnk fmrwA bqwm fqAl lhm swybT -t$trwn mny EbdA--- qAlwA 216

  seq: 211  nEm -qAl Anh Ebd lh kLm whw qA&#39;l lkm Any Hr fAn kntm A*A qA 269
           ||||| ||||||||||||||||||||||||||||||||||||||||||||||||||||||
  ref: 217  nEm fqAl Anh Ebd lh kLm whw qA&#39;l lkm Any Hr fAn kntm A*A qA 276

  seq: 270 l lkm h*h AlmqAlp trktmwh fL tfsdwA Ely Ebdy fqAlwA bl n$try 329
           ||||||||||||||||||||||||||||||||||||||||||||| ||||||||||||||
  ref: 277 l lkm h*h AlmqAlp trktmwh fL tfsdwA Ely Ebdy -qAlwA bl n$try 335

  seq: 330 h mnk-------- bE$r qL&#39;S vm jA&#39;wA fwDEwA fy Enqh HbL wEmAmp w 381
           |||||        ||||||||||||||||||||||||||||||||||||||
  ref: 336 h mnk fA$trwh bE$r qL&#39;S vm jA&#39;wA fwDEwA fy Enqh HbL--------- 386

  seq: 382 A$trwh fqAl nEymAn An h*A ysthz&#39; bkm wAny Hr -qAlwA qd Axbrn 440
                 ||||||||||||||||||||||||||||||||||||||| |||||||||    |
  ref: 386 ------ fqAl nEymAn An h*A ysthz&#39; bkm wAny Hr fqAlwA qd -Erfn 439

  seq: 441 A bxbrk wAnTlqwA bh ----wjA&#39; Abw bkr fAxbrwh fAtbEhm frd Ely 496
           || |||||||||||||||||     |||||||||||| ||||||||||||||| ||||||
  ref: 440 A -xbrk wAnTlqwA bh flmA jA&#39; Abw bkr -Axbrwh fAtbEhm wrd Ely 497

  seq: 497 hm AlqL&#39;S wAx*h flmA qdmwA Ely Alnby Sly G Elyh wslm Axbrwh  556
           ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||
  ref: 498 hm AlqL&#39;S wAx*h flmA qdmwA Ely Alnby Sly G Elyh wslm Axbrwh  557

  seq: 557 fDHk hw wASHAbh mn-hmA Hwl 581
           ||||||||||||||||||    |||
  ref: 558 fDHk hw wASHAbh mn *lk HwL 583</code></pre><p>This is the same with the result above, but this one is the Buckwalter encoded Arabic input.</p><p>The number in the left side is the index of the first character in the row, whereas the number in the right side is the index of the last character in the row.</p><h3 id="Alignment-statistics"><a class="docs-heading-anchor" href="#Alignment-statistics">Alignment statistics</a><a id="Alignment-statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Alignment-statistics" title="Permalink"></a></h3><p>From the results above, we can extract the score of the alignment which is a  distance measure between the reference and the target texts. The lower the score the similar the two texts therefore.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; score(res1)</code><code class="nohighlight hljs ansi" style="display:block;">113</code></pre><p>Other statistics are as follows</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_matches(res1)</code><code class="nohighlight hljs ansi" style="display:block;">513</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_mismatches(res1)</code><code class="nohighlight hljs ansi" style="display:block;">25</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_insertions(res1)</code><code class="nohighlight hljs ansi" style="display:block;">43</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_deletions(res1)</code><code class="nohighlight hljs ansi" style="display:block;">45</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_aligned(res1)</code><code class="nohighlight hljs ansi" style="display:block;">626</code></pre><h2 id="Multiple-Alignments"><a class="docs-heading-anchor" href="#Multiple-Alignments">Multiple Alignments</a><a id="Multiple-Alignments-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-Alignments" title="Permalink"></a></h2><p>At times, especially when working with books, the input texts are long enough that it becomes computationally expensive to do the alignment directly. A simple solution is to partition the input  texts into parts and do the alignment, pairing the texts by permutation. For example, in the KITAB&#39;s text reuse use case the books are partitioned into &quot;milestone&quot; which is indicated by a prefix <code>ms</code> in the texts. To mimick this, we&#39;ll add <code>ms</code> into the  <code>shamela0012129</code> and <code>shamela0023790</code> as follows:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0012129 = &quot;خرج مع ابي بكر الصديق رضي الله عنه في تجارة الي بصري ومعهم نعيمان وكان نعيمان ممن شهد——- بدرا ايضا وك——-ان علي الزاد فقال له سويبط———– اطعمني فقال حتي يجء ابو بكر فقال اما والله لاغيظنك فمروا بقوم فقال لهم سويبط -تشترون مني عبدا قا—لوا نعم فقال انه عبد له كلام وهو قاءل لكم اني حر فان كنتم اذا قال لكم هذهmsتركتموه فلا تفسدوا علي عبدي قا-لوا بل نشتريه منك فاشتروه بعشر قلاءص ثم جاءوا فوضعوا في عنقه حبلا ف—————قال نعيمان ان هذا يستهزء بكم واني حر فقالوا قد عرفنا –خبرك وانطلقوا به فلما جاء ابو بكر -اخبروه فاتبعهم ورد عليهم القلاءص واخذه فلما قدموا علي النبي صلي الله عليه وسلم اخبروه فضحك هو واصحابه من ذلك حولا&quot;;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0023790 = &quot;خرج— ابو بكر——————– في تجارة——— ومعه- نعيمان وسويبط بن حرملة وكانا شهدا بدر—–ا وكان نعيمان علي الزاد فقال له سويبط وكان مزاحا اطعمني فقال حتي يجء ابو بكر فقال اما والله لاغيظنك فمروا بقوم فقال لهم سويبط اتشترون مني عبدا لي قالوا نعم ق-ال انه عبد له كلام وهو قاءل لكم اني حر فان كنتم اذا قال لكم هذه المقالة تركتموهmsفلا تفسدوا علي عبدي فقالوا بل نشتريه منك——– بعشر قلاءص ثم جاءوا فوضعوا في عنقه حبلا وعمامة واشتروه فقال نعيمان ان هذا يستهزء بكم واني حر قا-لوا قد اخبرنا بخبرك وانطلقوا به و—-جاء ابو بكر فاخبروه فاتبعهم فرد عليهم القلاءص واخذه فلما قدموا علي النبي صلي الله عليه وسلم اخبروه فضحك هو واصحابه منهما- حول&quot;;</code></pre><p>We will then split this into milestones,</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0012129 = string.(split(shamela0012129, &quot;ms&quot;))</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{String}:
 &quot;خرج مع ابي بكر الصديق رضي الله &quot;<span class="sgr93"><span class="sgr1"> ⋯ 447 bytes ⋯ </span></span>&quot;ني حر فان كنتم اذا قال لكم هذه&quot;
 &quot;تركتموه فلا تفسدوا علي عبدي قا-&quot;<span class="sgr93"><span class="sgr1"> ⋯ 448 bytes ⋯ </span></span>&quot;وه فضحك هو واصحابه من ذلك حولا&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0023790 = string.(split(shamela0023790, &quot;ms&quot;))</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{String}:
 &quot;خرج— ابو بكر——————– في تجارة———&quot;<span class="sgr93"><span class="sgr1"> ⋯ 455 bytes ⋯ </span></span>&quot;ذا قال لكم هذه المقالة تركتموه&quot;
 &quot;فلا تفسدوا علي عبدي فقالوا بل ن&quot;<span class="sgr93"><span class="sgr1"> ⋯ 437 bytes ⋯ </span></span>&quot;روه فضحك هو واصحابه منهما- حول&quot;</code></pre><p>Then as before, we clean the splitted texts:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0012129_cln = clean.(shamela0012129)</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{String}:
 &quot;خرج مع ابي بكر الصديق رضي الله &quot;<span class="sgr93"><span class="sgr1"> ⋯ 417 bytes ⋯ </span></span>&quot;ني حر فان كنتم اذا قال لكم هذه&quot;
 &quot;تركتموه فلا تفسدوا علي عبدي قال&quot;<span class="sgr93"><span class="sgr1"> ⋯ 427 bytes ⋯ </span></span>&quot;وه فضحك هو واصحابه من ذلك حولا&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0023790_cln = clean.(shamela0023790)</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{String}:
 &quot;خرج ابو بكر في تجارة ومعه نعيما&quot;<span class="sgr93"><span class="sgr1"> ⋯ 427 bytes ⋯ </span></span>&quot;ذا قال لكم هذه المقالة تركتموه&quot;
 &quot;فلا تفسدوا علي عبدي فقالوا بل ن&quot;<span class="sgr93"><span class="sgr1"> ⋯ 421 bytes ⋯ </span></span>&quot;بروه فضحك هو واصحابه منهما حول&quot;</code></pre><div class="admonition is-info" id="Note-e9779504468e4e35"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-e9779504468e4e35" title="Permalink"></a></header><div class="admonition-body"><p>In Julia, we suffix the name of the function with <code>.</code> to broadcast the function to each item of the list. In this case, we clean each splitted texts.</p></div></div><p>Next, we normalize the characters as before:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; mapping = Dict(
           &quot;الله&quot; =&gt; &quot;ﷲ&quot;,
           &quot;لا&quot; =&gt; &quot;ﻻ&quot;
       );</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0012129_nrm = normalize(shamela0012129_cln, mapping)</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{String}:
 &quot;خرج مع ابي بكر الصديق رضي ﷲ عنه&quot;<span class="sgr93"><span class="sgr1"> ⋯ 404 bytes ⋯ </span></span>&quot;ني حر فان كنتم اذا قال لكم هذه&quot;
 &quot;تركتموه فﻻ تفسدوا علي عبدي قالو&quot;<span class="sgr93"><span class="sgr1"> ⋯ 415 bytes ⋯ </span></span>&quot;روه فضحك هو واصحابه من ذلك حوﻻ&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0023790_nrm = normalize(shamela0023790_cln, mapping)</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{String}:
 &quot;خرج ابو بكر في تجارة ومعه نعيما&quot;<span class="sgr93"><span class="sgr1"> ⋯ 420 bytes ⋯ </span></span>&quot;ذا قال لكم هذه المقالة تركتموه&quot;
 &quot;فﻻ تفسدوا علي عبدي فقالوا بل نش&quot;<span class="sgr93"><span class="sgr1"> ⋯ 411 bytes ⋯ </span></span>&quot;بروه فضحك هو واصحابه منهما حول&quot;</code></pre><p>And we encode them as follows</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0012129_enc = encode.(shamela0012129_nrm)</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{String}:
 &quot;xrj mE Aby bkr AlSdyq rDy G Enh&quot;<span class="sgr93"><span class="sgr1"> ⋯ 224 bytes ⋯ </span></span>&quot;ny Hr fAn kntm A*A qAl lkm h*h&quot;
 &quot;trktmwh fL tfsdwA Ely Ebdy qAlw&quot;<span class="sgr93"><span class="sgr1"> ⋯ 228 bytes ⋯ </span></span>&quot;rwh fDHk hw wASHAbh mn *lk HwL&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shamela0023790_enc = encode.(shamela0023790_nrm)</code><code class="nohighlight hljs ansi" style="display:block;">2-element Vector{String}:
 &quot;xrj Abw bkr fy tjArp wmEh nEymA&quot;<span class="sgr93"><span class="sgr1"> ⋯ 233 bytes ⋯ </span></span>&quot;*A qAl lkm h*h AlmqAlp trktmwh&quot;
 &quot;fL tfsdwA Ely Ebdy fqAlwA bl n\$&quot;<span class="sgr93"><span class="sgr1"> ⋯ 225 bytes ⋯ </span></span>&quot;brwh fDHk hw wASHAbh mnhmA Hwl&quot;</code></pre><p>Finally, we run the alignment.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res2, scr = align(shamela0012129_enc, shamela0023790_enc);</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr36"><span class="sgr1">[ Info: </span></span>50.0%, aligning 1st reference milestone to all target milestone.
<span class="sgr36"><span class="sgr1">[ Info: </span></span>100.0%, aligning 2nd reference milestone to all target milestone.</code></pre><p>Note that if the input texts are Array or Matrix the <code>align</code> function returns a tuple, comprising of the result of the alignment in Matrix, and the corresponding scores in Matrix.</p><p>Here is the score of the comparison, where the rows correspond to the index of the partitions of the reference text, and the  columns correspond to the index of the partitions of the target text.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; scr</code><code class="nohighlight hljs ansi" style="display:block;">2×2 Matrix{Int64}:
  87  216
 218   50</code></pre><p>The corresponding result of the score is also a Matrix, but it is huge since each cell of the matrix correspond to the result of the alignment and printing it would be difficult to understand. It is therefore better to simply index the Matrix to view only part of it.</p><p>For example, the corresponding result of the score in the first row first column is given below</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res2[1,1] # result of the score scr[1,1]</code><code class="nohighlight hljs ansi" style="display:block;">PairwiseAlignment
١-reference
٢-target

٢    خرجـــ ابو بكـــــــــرــــــــ في تجارةـــــــــ ومعهـ نعي
     ااا   ااا ااا         ا        ااااااااا         ااااا اااا
١    خرج مع ابي بكر الصديق رضي ﷲ عنه في تجارة الي بصري ومعهم نعي

٢    ان وسويبط بن حرملة وكانا شهدا بدرا وكان نعيمان علي الزاد فق
     ااا  ا   ا ا   ا  ا   ا اااا اااااا  ا      ااااااااااااااا
١    ان ــوكان ـنـعيمان ـممنـ شهدـ بدرا ــايضا وكان علي الزاد فق

٢    ل له سويبط وكان مزاحا اطعمني فقال حتي يجء ابو بكر فقال اما
     اااااااااا           اااااااااااااااااااااااااااااااااااااا
١    ل له سويبطـــــــــــ اطعمني فقال حتي يجء ابو بكر فقال اما

٢    ﷲ ﻻغيظنك فمروا بقوم فقال لهم سويبط اتشترون مني عبدا لي قالو
     ااااااااااااااااااااااااااااااااااا ااااااااااااااا   ااااا
١    ﷲ ﻻغيظنك فمروا بقوم فقال لهم سويبط ـتشترون مني عبداـــ قالو

٢     نعم ـقال انه عبد له كﻻم وهو قاءل لكم اني حر فان كنتم اذا ق
     ااااا ااااااااااااااااااااااااااااااااااااااااااااااااااااا
١     نعم فقال انه عبد له كﻻم وهو قاءل لكم اني حر فان كنتم اذا ق</code></pre><p>For the result of the score in the second row first column, we have</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; res2[2,1] # result of the score scr[2,1]</code><code class="nohighlight hljs ansi" style="display:block;">PairwiseAlignment
١-reference
٢-target

٢    خرج ابو بكر في تـجارة ومعه نعيمان وسويبط بن حرملة وكانا شهد
      ا    ا    اا اا     ا       ا    ا   ا ا ا  ا     ا  ا
١    ترـكتموـــه فﻻ تفسدوا علي عبدي قالوـا بل ـنشتريه منك فاشترو

٢     بدرا وكان نعيمان علي الزاد فقال له سويبط وكان مزاحاـ اطعمن
     اا   ا    ا    ا         ا اا     اا   ا ا  ا ا    ا اا   ا
١     بعشر قﻻءص ثم جاءوا فوضعواـ في عنقه ــحبﻻ فقال نعيمان اـــن

٢     فقال حتــي يجء ـابو بكر فقال اما وﷲ ﻻغيظنك فمرــواـ بقوـــ
     ا  ا   ا   ا   ا ا  ا  اااااا   اا  ا    ا ا  ا  اا   اا
١     هذا يستهزء بكم واني ـحر فقالــوا قد ـعرفنا خبرك وانطلقوا ب

٢     فقال لهم ـسويبـط اتشترون مني عبدا لي قالوا نعم قال انه عبد
     اا   ا   ا  ا ا  اا   اا ا    ا   ا     ا     اا اا    ا
١     فلما جاء ابو بكر اـخبروه فاتبعـهم ورد علـــيهم ـالقﻻءص ـوا

٢    له كﻻمـ ـوهوـ قاءل لـكم اني حر فان كنتم اذا قال لكم هذه اــ
      اا  ا ا   ا ا     ا   ا  اا      ا   ااا          اا   ا
١    ذه فلما قدموا علي النبي صلي ﷲ عليه وسلم اخبروه فضحك هو واصح</code></pre><p>Finally, as before we can extract the statistics for each result:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_matches(res2[2,1])</code><code class="nohighlight hljs ansi" style="display:block;">95</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_mismatches(res2[2,1])</code><code class="nohighlight hljs ansi" style="display:block;">175</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_insertions(res2[2,1])</code><code class="nohighlight hljs ansi" style="display:block;">24</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_deletions(res2[2,1])</code><code class="nohighlight hljs ansi" style="display:block;">19</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_aligned(res2[2,1])</code><code class="nohighlight hljs ansi" style="display:block;">313</code></pre><h2 id="Visualization"><a class="docs-heading-anchor" href="#Visualization">Visualization</a><a id="Visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization" title="Permalink"></a></h2><p>In this section, we are going to display the alignment by plotting the results.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using CairoMakie</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; f, a, xys = plot(res1, :matches, nchars=60)</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 0.0%
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 15.62%
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 31.25%
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 46.88%
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 62.5%
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 78.12%
<span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 93.75%
(Scene (800px, 600px):
  0 Plots
  3 Child Scenes:
    ├ Scene (800px, 600px)
    ├ Scene (800px, 600px)
    └ Scene (800px, 600px), (Axis (2 plots), Axis (65 plots), Axis (2 plots)), (([1, 1, 1, 1, 1, 1, 1, 1, 1, 1  …  10, 10, 10, 10, 10, 10, 10, 10, 10, 10], Float32[59.0, 58.0, 57.0, 56.0, 55.0, 54.0, 52.0, 51.0, 50.0, 49.0  …  32.0, 31.0, 30.0, 29.0, 28.0, 27.0, 26.0, 22.0, 21.0, 20.0]), ([1, 1, 1, 1, 1, 1, 2, 2, 2, 3  …  57, 57, 57, 58, 58, 58, 58, 58, 59, 59], Float32[9.0, 8.0, 7.0, 3.0, 2.0, 1.0, 9.0, 8.0, 7.0, 7.0  …  3.0, 2.0, 1.0, 9.0, 8.0, 7.0, 6.0, 5.0, 9.0, 8.0])))</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xlabel = &quot;Shamela0023790&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Shamela0023790&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xlabelsize = 20</code><code class="nohighlight hljs ansi" style="display:block;">20</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xticks = 0:2:unique(xys[1][1])[end]</code><code class="nohighlight hljs ansi" style="display:block;">0:2:10</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xlabel = &quot;Shamela0012129&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Shamela0012129&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xlabelsize = 20</code><code class="nohighlight hljs ansi" style="display:block;">20</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xticks = 0:2:unique(xys[2][1])[end]</code><code class="nohighlight hljs ansi" style="display:block;">0:2:58</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; f</code><code class="nohighlight hljs ansi" style="display:block;">Figure()</code></pre><p>The figure above is divided into three subplots arranged in rows. You can think of the figure as two input text displayed in horizontal (i.e, sideways) orientation. In this orientation, the x-axis becomes the rows of the texts, that is, you can think of the x-axis as the rows of the texts in the book. In this case, we have two books, the reference and the target books. Each dot in reference and target corresponds to the characters that have matched. The lines and curves in the middle (colored in red) represent the connections of the rows of the texts where the matched happened. Further, the y-axis correspond to the length of the rows, in this case 60 characters per row. As you can see, the top tick label of the y-axis is 0 and the bottom tick label of the y-axis is 60, this is because the writing of Arabic is right-to-left, and so we can think of the 0th-tick at the top as the starting index of the first character in both texts, and the row ends at the 60th-tick at the bottom.</p><p>We added further customization to the plot, readers are encouraged to explore the API.</p><p>As for the plot of insertions of characters, we have:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; f, a, xys = plot(res1, :insertions, nchars=60)</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 0.0%
(Scene (800px, 600px):
  0 Plots
  3 Child Scenes:
    ├ Scene (800px, 600px)
    ├ Scene (800px, 600px)
    └ Scene (800px, 600px), (Axis (2 plots), Axis (9 plots), Axis (2 plots)), (([1, 1, 1, 1, 1, 1, 1, 2, 2, 2  …  7, 7, 7, 7, 7, 7, 7, 8, 8, 8], Float32[26.0, 25.0, 19.0, 17.0, 10.0, 6.0, 1.0, 54.0, 53.0, 19.0  …  39.0, 38.0, 37.0, 36.0, 35.0, 34.0, 33.0, 44.0, 37.0, 6.0]), ([2, 2, 2, 2, 2, 2, 2, 2, 2, 3  …  7, 8, 8, 8, 8, 8, 8, 8, 9, 9], Float32[56.0, 55.0, 49.0, 47.0, 40.0, 36.0, 31.0, 24.0, 23.0, 49.0  …  1.0, 59.0, 58.0, 57.0, 56.0, 55.0, 54.0, 4.0, 57.0, 22.0])))</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xlabel = &quot;Shamela0023790&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Shamela0023790&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xlabelsize = 20</code><code class="nohighlight hljs ansi" style="display:block;">20</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xticks = 0:2:unique(xys[1][1])[end]</code><code class="nohighlight hljs ansi" style="display:block;">0:2:8</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xlabel = &quot;Shamela0012129&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Shamela0012129&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xlabelsize = 20</code><code class="nohighlight hljs ansi" style="display:block;">20</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xticks = 0:2:unique(xys[2][1])[end]</code><code class="nohighlight hljs ansi" style="display:block;">0:2:8</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; f</code><code class="nohighlight hljs ansi" style="display:block;">Figure()</code></pre><p>For deletions, we have:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; f, a, xys = plot(res1, :deletions, nchars=60)</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 0.0%
(Scene (800px, 600px):
  0 Plots
  3 Child Scenes:
    ├ Scene (800px, 600px)
    ├ Scene (800px, 600px)
    └ Scene (800px, 600px), (Axis (2 plots), Axis (7 plots), Axis (2 plots)), (([1, 1, 1, 1, 1, 1, 1, 1, 1, 1  …  7, 7, 7, 7, 8, 9, 9, 9, 9, 11], Float32[56.0, 55.0, 54.0, 46.0, 45.0, 44.0, 43.0, 42.0, 41.0, 40.0  …  50.0, 49.0, 48.0, 47.0, 14.0, 39.0, 38.0, 37.0, 36.0, 41.0]), ([1, 1, 1, 1, 1, 1, 1, 1, 1, 1  …  6, 6, 6, 6, 8, 8, 8, 8, 8, 10], Float32[56.0, 55.0, 54.0, 46.0, 45.0, 44.0, 43.0, 42.0, 41.0, 40.0  …  15.0, 14.0, 13.0, 12.0, 54.0, 21.0, 20.0, 19.0, 18.0, 24.0])))</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xlabel = &quot;Shamela0023790&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Shamela0023790&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xlabelsize = 20</code><code class="nohighlight hljs ansi" style="display:block;">20</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xticks = 0:2:unique(xys[1][1])[end]</code><code class="nohighlight hljs ansi" style="display:block;">0:2:10</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xlabel = &quot;Shamela0012129&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Shamela0012129&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xlabelsize = 20</code><code class="nohighlight hljs ansi" style="display:block;">20</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xticks = 0:2:unique(xys[2][1])[end]</code><code class="nohighlight hljs ansi" style="display:block;">0:2:10</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; f</code><code class="nohighlight hljs ansi" style="display:block;">Figure()</code></pre><p>And for mismatches, we have</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; f, a, xys = plot(res1, :mismatches, nchars=60)</code><code class="nohighlight hljs ansi" style="display:block;"><span class="sgr36"><span class="sgr1">[ Info: </span></span>Processing 0.0%
(Scene (800px, 600px):
  0 Plots
  3 Child Scenes:
    ├ Scene (800px, 600px)
    ├ Scene (800px, 600px)
    └ Scene (800px, 600px), (Axis (2 plots), Axis (7 plots), Axis (2 plots)), (([1, 1, 1, 1, 1, 1, 1, 1, 1, 1  …  2, 8, 8, 8, 8, 9, 10, 10, 10, 10], Float32[53.0, 23.0, 22.0, 21.0, 16.0, 15.0, 13.0, 12.0, 9.0, 8.0  …  46.0, 43.0, 42.0, 41.0, 19.0, 50.0, 25.0, 24.0, 23.0, 19.0]), ([1, 2, 2, 2, 2, 2, 2, 2, 2, 2  …  2, 8, 8, 8, 8, 9, 10, 10, 10, 10], Float32[50.0, 55.0, 54.0, 53.0, 50.0, 49.0, 47.0, 46.0, 44.0, 43.0  …  25.0, 44.0, 43.0, 42.0, 17.0, 49.0, 23.0, 22.0, 21.0, 17.0])))</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xlabel = &quot;Shamela0023790&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Shamela0023790&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xlabelsize = 20</code><code class="nohighlight hljs ansi" style="display:block;">20</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[1].xticks = 0:2:unique(xys[1][1])[end]</code><code class="nohighlight hljs ansi" style="display:block;">0:2:10</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xlabel = &quot;Shamela0012129&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;Shamela0012129&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xlabelsize = 20</code><code class="nohighlight hljs ansi" style="display:block;">20</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; a[3].xticks = 0:2:unique(xys[2][1])[end]</code><code class="nohighlight hljs ansi" style="display:block;">0:2:10</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; f</code><code class="nohighlight hljs ansi" style="display:block;">Figure()</code></pre><h2 id="Cost-Model"><a class="docs-heading-anchor" href="#Cost-Model">Cost Model</a><a id="Cost-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Cost-Model" title="Permalink"></a></h2><p>The pairwise alignment above works by minimizing a cost function, which is define by a cost model. It is important that we understand how the cost model is setup so that we can give proper scoring for the mismatches, matches, deletions and insertions. To define a cost model, we use <a href="https://github.com/BioJulia/BioAlignments.jl">BioAligments.jl</a>&#39;s <code>CostModel</code> struct.</p><p>The default cost model is given by</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using BioAlignments</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; costmodel = CostModel(match=0, mismatch=1, insertion=1, deletion=1)</code><code class="nohighlight hljs ansi" style="display:block;">BioAlignments.CostModel{Int64}(BioAlignments.DichotomousSubstitutionMatrix{Int64}:
     match = 0
  mismatch = 1, 1, 1)</code></pre><div class="admonition is-info" id="Interpretation-of-CostModel-a2818dbd7171ff0f"><header class="admonition-header">Interpretation of CostModel<a class="admonition-anchor" href="#Interpretation-of-CostModel-a2818dbd7171ff0f" title="Permalink"></a></header><div class="admonition-body"><p>The instantiated <code>costmodel</code> above tells us that, if a matched happened between the characters of the reference and the target texts, we set it to 0. Otherwise, that is, if mismatch, insertions or deletions happened, then the distance is 1.</p></div></div><div class="admonition is-info" id="Optimization-of-the-Alignment-639278595c924291"><header class="admonition-header">Optimization of the Alignment<a class="admonition-anchor" href="#Optimization-of-the-Alignment-639278595c924291" title="Permalink"></a></header><div class="admonition-body"><p>The alignment is optimized by minimizing the cost function defined by the cost model, by prioritizing matches since it gives the algorithm a lower distance (which is 0)</p></div></div><p>If we set the costmodel to the following,</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using BioAlignments</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; costmodel = CostModel(match=0, mismatch=10, insertion=3, deletion=1)</code><code class="nohighlight hljs ansi" style="display:block;">BioAlignments.CostModel{Int64}(BioAlignments.DichotomousSubstitutionMatrix{Int64}:
     match =  0
  mismatch = 10, 3, 1)</code></pre><p>Then if a mismatch happened, the algorithm will instead consider it a deletion as much as possible to avoid a distance score of 10 (for mismatch) and go for a distance of 1 (for deletion) instead.</p><p>Consider the following example,</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using Yunir</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; etgt = &quot;رضي الله عنه&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;رضي الله عنه&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; eref = &quot;صلي الله عليه وسلم&quot;</code><code class="nohighlight hljs ansi" style="display:block;">&quot;صلي الله عليه وسلم&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; mapping = Dict(&quot;الله&quot; =&gt; &quot;ﷲ&quot;,)</code><code class="nohighlight hljs ansi" style="display:block;">Dict{String, String} with 1 entry:
  &quot;الله&quot; =&gt; &quot;ﷲ&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; etgt_nrm = normalize(etgt, mapping)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;رضي ﷲ عنه&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; eref_nrm = normalize(eref, mapping)</code><code class="nohighlight hljs ansi" style="display:block;">&quot;صلي ﷲ عليه وسلم&quot;</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; costmodel = CostModel(match=0, mismatch=1, insertion=1, deletion=1);</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; res_c1 = align(encode(eref_nrm), encode(etgt_nrm), costmodel=costmodel)</code><code class="nohighlight hljs ansi" style="display:block;">PairwiseAlignment
١-reference
٢-target

٢    رضي ﷲ عـنهــــ
       ااااا  ا
١    صلي ﷲ عليه وسل</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; res_c1</code><code class="nohighlight hljs ansi" style="display:block;">PairwiseAlignment
١-reference
٢-target

٢    رضي ﷲ عـنهــــ
       ااااا  ا
١    صلي ﷲ عليه وسل</code></pre><p>Now, compare the result if we increased the mismatch and insertion in the cost model.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; costmodel = CostModel(match=0, mismatch=10, insertion=5, deletion=1)</code><code class="nohighlight hljs ansi" style="display:block;">BioAlignments.CostModel{Int64}(BioAlignments.DichotomousSubstitutionMatrix{Int64}:
     match =  0
  mismatch = 10, 5, 1)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; res_c2 = align(encode(eref_nrm), encode(etgt_nrm), costmodel=costmodel)</code><code class="nohighlight hljs ansi" style="display:block;">PairwiseAlignment
١-reference
٢-target

٢    رضــي ﷲ عنــهــــ
         ااااا   ا
١    ــصلي ﷲ عـليه وسل</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; res_c2</code><code class="nohighlight hljs ansi" style="display:block;">PairwiseAlignment
١-reference
٢-target

٢    رضــي ﷲ عنــهــــ
         ااااا   ا
١    ــصلي ﷲ عـليه وسل</code></pre><p>You can copy and paste the result to any text editor with Arabic monospace, like in <a href="https://notepad-plus-plus.org/">Notepad++</a> screenshot above to see the alignment properly.</p><p>You will notice that, in <code>res_c1</code> above we have 3 mismatches, but in <code>res_c2</code> the algorithm avoided assigning mismatches and instead prioritized deletions and insertions. This can be confirmed below:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_mismatches(res_c1)</code><code class="nohighlight hljs ansi" style="display:block;">3</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_deletions(res_c1)</code><code class="nohighlight hljs ansi" style="display:block;">6</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_insertions(res_c1)</code><code class="nohighlight hljs ansi" style="display:block;">0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_mismatches(res_c2)</code><code class="nohighlight hljs ansi" style="display:block;">0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_deletions(res_c2)</code><code class="nohighlight hljs ansi" style="display:block;">9</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; count_insertions(res_c2)</code><code class="nohighlight hljs ansi" style="display:block;">3</code></pre></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 3 October 2025 15:57">Friday 3 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
